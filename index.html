<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Cool Blues (#EFF6FF, #3B82F6, #1E40AF, #111827) -->
    <!-- Application Structure Plan: æœ¬åº”ç”¨è®¾è®¡ä¸ºä¸€ä¸ªå•é¡µã€å¤šæ­¥éª¤çš„äº¤äº’å¼åŸå‹ï¼Œæ—¨åœ¨ç²¾ç¡®æ¨¡æ‹Ÿç”¨æˆ·åœ¨å›¾ç‰‡ä¸­å±•ç¤ºçš„å››æ­¥æ“ä½œæµç¨‹ã€‚ç”¨æˆ·é€šè¿‡ç‚¹å‡»æŒ‰é’®åœ¨ä¸åŒè§†å›¾é—´åˆ‡æ¢ï¼Œæ¨¡æ‹Ÿä»ä»»åŠ¡è®¾å®šåˆ°å†…å®¹ç”Ÿæˆçš„å®Œæ•´æ—…ç¨‹ã€‚1. **å¯¼èˆª/æ­¥éª¤æŒ‡ç¤ºå™¨**: æ¸…æ™°å±•ç¤ºç”¨æˆ·å½“å‰æ‰€å¤„æ­¥éª¤ã€‚2. **æ­¥éª¤ä¸€ï¼šä»»åŠ¡è®¾å®š**: ä¸€ä¸ªè¡¨å•ï¼Œç”¨äºå®šä¹‰ç›‘æ§å’Œæ”¹å†™å‚æ•°ã€‚3. **æ­¥éª¤äºŒï¼šæœç´¢ç»“æœ**: ä¸€ä¸ªå¯äº¤äº’çš„è¡¨æ ¼ï¼Œæ”¯æŒå¤šé€‰ï¼Œå±•ç¤ºAIæœç´¢å’Œè¿‡æ»¤åçš„å†…å®¹åˆ—è¡¨ã€‚4. **æ­¥éª¤ä¸‰ï¼šæ‰¹é‡æ”¹å†™**: ä¸€ä¸ªåˆ—è¡¨è§†å›¾ï¼Œå±•ç¤ºæ‰€æœ‰è¢«é€‰ä¸­å†…å®¹çš„å¤šç‰ˆæœ¬æ”¹å†™ï¼Œå¹¶æ”¯æŒä¸ºæ¯ä¸ªåŸæ–‡é€‰æ‹©ä¸€ä¸ªæœ€ä½³æ”¹å†™ã€‚5. **æ­¥éª¤å››ï¼šç¡®è®¤è¾“å‡º**: æœ€ç»ˆäº§å‡ºç‰©çš„ç¡®è®¤é¡µé¢ï¼Œæ¨¡æ‹Ÿæ‰¹é‡å­˜å…¥çŸ¥è¯†åº“çš„åœºæ™¯ã€‚è¿™ä¸ªç»“æ„ç´§å¯†è´´åˆäº†ç”¨æˆ·çš„è§†è§‰ç¨¿å’Œæ–°éœ€æ±‚ï¼Œç¡®ä¿æ¼”ç¤ºçš„ç›´è§‚æ€§å’Œç›¸å…³æ€§ã€‚ -->
    <!-- Visualization & Content Choices: 1. **ä»»åŠ¡è®¾å®š**: Goal: Configure. Method: ä½¿ç”¨æ ‡å‡†çš„HTMLè¡¨å•å…ƒç´ ï¼Œé…åˆTailwind CSSç¾åŒ–ã€‚2. **æœç´¢ç»“æœ**: Goal: Explore & Select. Method: HTMLè¡¨æ ¼å¢åŠ å¤é€‰æ¡†å®ç°å¤šé€‰ï¼Œé€šè¿‡JSå®ç°åŠ¨æ€æ¸²æŸ“å’Œäº¤äº’ã€‚3. **æ‰¹é‡æ”¹å†™**: Goal: Compare & Select. Method: ä½¿ç”¨å¡ç‰‡åˆ—è¡¨å¸ƒå±€ï¼Œæ¯ä¸ªå¡ç‰‡åŒ…å«åŸæ–‡å’Œå¤šä¸ªå¯é€‰æ‹©çš„æ”¹å†™ç‰ˆæœ¬ï¼ˆé€šè¿‡å•é€‰æ¡†å®ç°ï¼‰ï¼Œç›´è§‚å±•ç¤ºAIçš„æ”¹å†™èƒ½åŠ›ã€‚4. **ç¡®è®¤è¾“å‡º**: Goal: Review & Confirm. Method: å¡ç‰‡å¼å¸ƒå±€ï¼Œæ±‡æ€»å±•ç¤ºæœ€ç»ˆé€‰å®šçš„æ‰€æœ‰æ–‡æ¡ˆï¼Œæ¨¡æ‹Ÿå­˜å…¥çŸ¥è¯†åº“å‰çš„æœ€åå®¡æ ¸ã€‚æ‰€æœ‰å…ƒç´ å‡é€šè¿‡HTML/Tailwind/JSå®ç°ï¼Œæ— ä»»ä½•SVGæˆ–å›¾è¡¨åº“ï¼Œå®Œå…¨ç¬¦åˆåŸå‹æ¼”ç¤ºçš„è¦æ±‚ã€‚ -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>å¤©ä¹å…±äº«AIçˆ†æ¬¾å†…å®¹ç”Ÿæˆå™¨ - äº¤äº’å¼åŸå‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f0f4f8;
        }
        .step-indicator {
            transition: all 0.4s ease;
        }
        .step-indicator.active {
            background-color: #3B82F6;
            color: white;
            font-weight: bold;
        }
        .step-indicator.completed {
            background-color: #1E40AF;
            color: white;
        }
        .form-input {
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .table-row-hover:hover {
            background-color: #EFF6FF;
        }
        .table-row-selected {
            background-color: #DBEAFE !important;
        }
        .loader {
            border-top-color: #3B82F6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æ‰§è¡Œæ–¹å¼å¡ç‰‡æ ·å¼ */
        .execution-mode-card {
            transition: all 0.2s ease-in-out;
        }

        .execution-mode-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .execution-mode-card input[type="radio"]:checked + div {
            color: #ea580c;
        }

        .execution-mode-card:has(input[type="radio"]:checked) {
            border-color: #fed7aa !important;
            background-color: #fff7ed;
        }

        /* æ­¥éª¤è¿›åº¦æ¡æ ·å¼ */
        .step-progress-line {
            transition: background-color 0.3s ease;
        }

        .step-progress-number {
            transition: all 0.3s ease;
        }

        .step-progress-number.active {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">å¤©ä¹å…±äº«AIçˆ†æ¬¾å†…å®¹ç”Ÿæˆå™¨</h1>
            <p class="mt-2 text-lg text-gray-600">äº¤äº’å¼äº§å“åŸå‹</p>
        </header>



        <!-- App Views -->
        <div id="app-views">
            <!-- Step 1: Settings -->
            <div id="view-step-1">
                <!-- é¡µé¢æ ‡é¢˜ -->
                <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-2xl mb-8">
                    <h2 class="text-2xl font-bold text-center">AIçˆ†æ¬¾å†…å®¹ç”Ÿæˆå¹³å°</h2>
                    <p class="text-center text-blue-100 mt-2">é€‰æ‹©æ‚¨éœ€è¦çš„åŠŸèƒ½æ¨¡å—</p>
                </div>

                <!-- ä¸¤ä¸ªç‹¬ç«‹åŠŸèƒ½æ¨¡å— -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                    <!-- æ¨¡å—1ï¼šæŠ¥å‘Šæ£€ç´¢è®¾ç½®æ¨é€ -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-4">
                            <h3 class="text-lg font-bold flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                æŠ¥å‘Šæ£€ç´¢è®¾ç½®æ¨é€
                            </h3>
                            <p class="text-purple-100 text-sm mt-1">ç›‘æ§çˆ†æ¬¾å†…å®¹ï¼Œå®šæœŸç”ŸæˆæŠ¥å‘Š</p>
                        </div>
                        
                        <div class="p-6">
                            <!-- æ£€ç´¢é…ç½® -->
                            <div class="mb-6">
                                <h4 class="font-medium text-gray-800 mb-3">æ£€ç´¢é…ç½®</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ç›‘æ§æ¸ é“</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="report-channel" value="douyin" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" checked>
                                                <span class="ml-2 text-sm text-gray-700">æŠ–éŸ³</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="report-channel" value="xiaohongshu" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                                <span class="ml-2 text-sm text-gray-700">å°çº¢ä¹¦</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="report-channel" value="bilibili" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                                <span class="ml-2 text-sm text-gray-700">Bç«™</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="report-channel" value="kuaishou" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                                <span class="ml-2 text-sm text-gray-700">å¿«æ‰‹</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="report-channel" value="zhihu" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                                <span class="ml-2 text-sm text-gray-700">çŸ¥ä¹</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="report-keywords" class="block text-sm font-medium text-gray-700 mb-1">ç›‘æ§å…³é”®è¯</label>
                                        <input type="text" id="report-keywords" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="åˆ›äºŒä»£, åŸºä¸šé•¿é’, æƒ…æ„Ÿ" placeholder="è¯·è¾“å…¥å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”">
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-3">
                                        <div>
                                            <label for="report-extract-count" class="block text-sm font-medium text-gray-700 mb-1">æå–æ•°é‡</label>
                                            <input type="number" id="report-extract-count" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="20">
                                        </div>
                                        <div>
                                            <label for="report-likes-filter" class="block text-sm font-medium text-gray-700 mb-1">ç‚¹èµè¿‡æ»¤</label>
                                            <input type="number" id="report-likes-filter" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="100">
                                        </div>
                                        <div>
                                            <label for="report-comments-filter" class="block text-sm font-medium text-gray-700 mb-1">è¯„è®ºè¿‡æ»¤</label>
                                            <input type="number" id="report-comments-filter" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="20">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æŠ¥å‘Šç”Ÿæˆè®¾ç½® -->
                            <div class="mb-6">
                                <h4 class="font-medium text-gray-800 mb-3">æŠ¥å‘Šç”Ÿæˆè®¾ç½®</h4>
                                <div class="space-y-4">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="instant-report" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" checked>
                                        <span class="ml-3 text-sm text-gray-700 font-medium">å³æ—¶ç”ŸæˆæŠ¥å‘Š</span>
                                        <span class="ml-2 text-xs text-gray-500">ï¼ˆç”Ÿæˆå®Œæˆåç«‹å³åˆ›å»ºæŠ¥å‘Šï¼‰</span>
                                    </label>
                                    
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="scheduled-report" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                                        <span class="ml-3 text-sm text-gray-700 font-medium">å®šæ—¶ç”ŸæˆæŠ¥å‘Š</span>
                                        <span class="ml-2 text-xs text-gray-500">ï¼ˆè®¾ç½®ç‰¹å®šæ—¶é—´ç”ŸæˆæŠ¥å‘Šï¼‰</span>
                                    </label>
                                    
                                    <!-- ä¼ä¸šå¾®ä¿¡è¯´æ˜ -->
                                    <div class="mt-3 p-3 bg-blue-50 border-l-4 border-blue-400 rounded-r-md">
                                        <div class="flex items-center">
                                            <svg class="w-4 h-4 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                            </svg>
                                            <span class="text-xs text-blue-700 font-medium">ğŸ’¬ å®šæœŸæŠ¥å‘Šå¯åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æŸ¥çœ‹</span>
                                        </div>
                                    </div>
                                    
                                    <!-- å®šæ—¶è®¾ç½® -->
                                    <div id="schedule-time-container" class="ml-7 hidden">
                                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                            <h5 class="font-medium text-gray-800 mb-3">å®šæ—¶è®¾ç½®</h5>
                                            <div class="space-y-4">
                                                <div class="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label class="block text-xs text-gray-500 mb-1">é¢‘ç‡ç±»å‹</label>
                                                        <select id="schedule-frequency" class="form-input block w-full text-sm rounded-md border-gray-300 shadow-sm">
                                                            <option value="daily">æ¯å¤©</option>
                                                            <option value="weekly">æ¯å‘¨</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="block text-xs text-gray-500 mb-1">ç”Ÿæˆæ—¶é—´</label>
                                                        <select id="schedule-hour" class="form-input block w-full text-sm rounded-md border-gray-300 shadow-sm">
                                                            <option value="09">09:00</option>
                                                            <option value="10">10:00</option>
                                                            <option value="11">11:00</option>
                                                            <option value="14">14:00</option>
                                                            <option value="15">15:00</option>
                                                            <option value="16">16:00</option>
                                                            <option value="17">17:00</option>
                                                            <option value="18">18:00</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div id="weekly-day-container" class="hidden">
                                                    <label class="block text-xs text-gray-500 mb-1">æ¯å‘¨å“ªå¤©</label>
                                                    <select id="schedule-weekday" class="form-input block w-full text-sm rounded-md border-gray-300 shadow-sm">
                                                        <option value="1">æ¯å‘¨ä¸€</option>
                                                        <option value="2">æ¯å‘¨äºŒ</option>
                                                        <option value="3">æ¯å‘¨ä¸‰</option>
                                                        <option value="4">æ¯å‘¨å››</option>
                                                        <option value="5">æ¯å‘¨äº”</option>
                                                        <option value="6">æ¯å‘¨å…­</option>
                                                        <option value="0">æ¯å‘¨æ—¥</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- å¾®ä¿¡æ¨é€è®¾ç½® -->
                                                <div class="pt-3 border-t border-purple-200">
                                                    <h6 class="text-sm font-medium text-gray-800 mb-2">æ¨é€è®¾ç½®</h6>
                                                    <div class="space-y-3">
                                                        <div class="bg-white p-3 rounded-md border">
                                                            <div class="flex justify-between items-center mb-3">
                                                                <label class="block text-sm text-gray-600">å¾®ä¿¡æ¨é€å¯¹è±¡</label>
                                                                <button id="manage-wechat-users-btn" class="text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded transition-colors duration-200">
                                                                    ç®¡ç†å¾®ä¿¡ç”¨æˆ·
                                                                </button>
                                                            </div>
                                                            
                                                            <div id="wechat-users-list" class="space-y-2 max-h-32 overflow-y-auto">
                                                                <div class="text-center text-gray-400 text-xs py-2">
                                                                    è¯·å…ˆæ·»åŠ å¾®ä¿¡ç”¨æˆ·
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="mt-3 pt-2 border-t border-gray-200">
                                                                <div class="flex items-center text-xs text-gray-500">
                                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                                                    </svg>
                                                                    <span>å·²é€‰æ‹© <span id="selected-users-count">0</span> ä½ç”¨æˆ·æ¨é€</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- åŠŸèƒ½æŒ‰é’® -->
                            <div class="mt-6 pt-4 border-t border-purple-200">
                                <div class="grid grid-cols-1 gap-3">
                                    <button id="view-scheduled-tasks-btn" class="w-full bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium py-3 px-4 rounded-lg transition-colors duration-200 text-sm flex items-center justify-center">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                        </svg>
                                        æŸ¥çœ‹å†å²ä»»åŠ¡
                                    </button>
                                    <button id="start-monitoring-btn" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        ç”Ÿæ•ˆè®¾ç½®
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¨¡å—2ï¼šæ”¹å†™æ–‡æ¡ˆåŠŸèƒ½ -->
                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-4">
                            <h3 class="text-lg font-bold flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                </svg>
                                æ”¹å†™æ–‡æ¡ˆåŠŸèƒ½
                            </h3>
                            <p class="text-green-100 text-sm mt-1">æ™ºèƒ½æ”¹å†™çˆ†æ¬¾å†…å®¹ï¼Œç”ŸæˆåŸåˆ›æ–‡æ¡ˆ</p>
                        </div>
                        
                        <!-- æ”¹å†™åŠŸèƒ½æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                        <div class="border-b border-gray-200 bg-gray-50 px-6 py-3">
                            <div id="rewrite-step-navigation" class="flex items-center justify-center">
                                <div class="flex items-center space-x-4">
                                    <div id="rewrite-step-1-indicator" class="rewrite-step-indicator active flex items-center">
                                        <div class="w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold">1</div>
                                        <span class="ml-2 text-sm text-green-600 font-medium">ä¸»é¢˜è®¾å®š</span>
                                    </div>
                                    <div class="w-6 h-px bg-gray-300"></div>
                                    <div id="rewrite-step-2-indicator" class="rewrite-step-indicator flex items-center">
                                        <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs font-bold">2</div>
                                        <span class="ml-2 text-sm text-gray-500">æœç´¢è¿‡æ»¤</span>
                                    </div>
                                    <div class="w-6 h-px bg-gray-300"></div>
                                    <div id="rewrite-step-3-indicator" class="rewrite-step-indicator flex items-center">
                                        <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs font-bold">3</div>
                                        <span class="ml-2 text-sm text-gray-500">æ‰¹é‡æ”¹å†™</span>
                                    </div>
                                    <div class="w-6 h-px bg-gray-300"></div>
                                    <div id="rewrite-step-4-indicator" class="rewrite-step-indicator flex items-center">
                                        <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs font-bold">4</div>
                                        <span class="ml-2 text-sm text-gray-500">ç¡®è®¤è¾“å‡º</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <!-- å†…å®¹æ¥æºè®¾ç½® -->
                            <div class="mb-6">
                                <h4 class="font-medium text-gray-800 mb-3">å†…å®¹æ¥æºè®¾ç½®</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">æœç´¢æ¸ é“</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="rewrite-channel" value="douyin" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500" checked>
                                                <span class="ml-2 text-sm text-gray-700">æŠ–éŸ³</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="rewrite-channel" value="xiaohongshu" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                                <span class="ml-2 text-sm text-gray-700">å°çº¢ä¹¦</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="rewrite-channel" value="bilibili" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                                <span class="ml-2 text-sm text-gray-700">Bç«™</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="rewrite-channel" value="kuaishou" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                                <span class="ml-2 text-sm text-gray-700">å¿«æ‰‹</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer">
                                                <input type="checkbox" name="rewrite-channel" value="zhihu" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                                <span class="ml-2 text-sm text-gray-700">çŸ¥ä¹</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="search-keywords" class="block text-sm font-medium text-gray-700 mb-1">æœç´¢å…³é”®è¯</label>
                                        <input type="text" id="search-keywords" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="åˆ›äºŒä»£, åŸºä¸šé•¿é’, æƒ…æ„Ÿ" placeholder="è¯·è¾“å…¥å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”">
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-3">
                                        <div>
                                            <label for="search-extract-count" class="block text-sm font-medium text-gray-700 mb-1">æœç´¢æ•°é‡</label>
                                            <input type="number" id="search-extract-count" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="15">
                                        </div>
                                        <div>
                                            <label for="search-likes-filter" class="block text-sm font-medium text-gray-700 mb-1">ç‚¹èµè¿‡æ»¤</label>
                                            <input type="number" id="search-likes-filter" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="50">
                                        </div>
                                        <div>
                                            <label for="search-comments-filter" class="block text-sm font-medium text-gray-700 mb-1">è¯„è®ºè¿‡æ»¤</label>
                                            <input type="number" id="search-comments-filter" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ”¹å†™é…ç½® -->
                            <div class="mb-6">
                                <h4 class="font-medium text-gray-800 mb-3">æ”¹å†™é…ç½®</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label for="rewrite-keywords" class="block text-sm font-medium text-gray-700 mb-1">æ”¹å†™å…³é”®è¯</label>
                                        <input type="text" id="rewrite-keywords" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="ä¸»åŠ¨æ¥æ£’, ä¼ æ‰¿" placeholder="è¯·è¾“å…¥æ”¹å†™å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”">
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="rewrite-count" class="block text-sm font-medium text-gray-700 mb-1">ç”Ÿæˆç¯‡æ•°</label>
                                            <input type="number" id="rewrite-count" class="form-input block w-full rounded-md border-gray-300 shadow-sm" value="4" min="1" max="10">
                                        </div>
                                        <div>
                                            <label for="rewrite-style" class="block text-sm font-medium text-gray-700 mb-1">æ”¹å†™é£æ ¼</label>
                                            <select id="rewrite-style" class="form-input block w-full rounded-md border-gray-300 shadow-sm">
                                                <option value="professional">ä¸“ä¸šåŒ–</option>
                                                <option value="casual">å£è¯­åŒ–</option>
                                                <option value="creative">åˆ›æ„åŒ–</option>
                                                <option value="formal">æ­£å¼åŒ–</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ‰§è¡Œæ–¹å¼ -->
                            <div class="mb-6">
                                <h4 class="font-medium text-gray-800 mb-3">æ‰§è¡Œæ–¹å¼</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <label class="flex items-start cursor-pointer p-3 border-2 border-transparent rounded-lg hover:border-green-200 transition-colors bg-green-50">
                                        <input type="radio" name="execution-mode" value="one-click" class="mt-1 h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500" checked>
                                        <div class="ml-3">
                                            <span class="block text-sm font-medium text-gray-900">ä¸€é”®ç”Ÿæˆ</span>
                                            <span class="block text-xs text-gray-500 mt-1">è‡ªåŠ¨æœç´¢å’Œæ”¹å†™ï¼Œå¿«é€Ÿç”Ÿæˆç»“æœ</span>
                                        </div>
                                    </label>
                                    <label class="flex items-start cursor-pointer p-3 border-2 border-transparent rounded-lg hover:border-green-200 transition-colors bg-green-50">
                                        <input type="radio" name="execution-mode" value="step-by-step" class="mt-1 h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500">
                                        <div class="ml-3">
                                            <span class="block text-sm font-medium text-gray-900">åˆ†æ­¥æ‰§è¡Œ</span>
                                            <span class="block text-xs text-gray-500 mt-1">é€æ­¥è¿›è¡Œï¼Œå¯ç²¾ç»†æ§åˆ¶å†…å®¹</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- å¼€å§‹æ”¹å†™æŒ‰é’® -->
                            <div class="text-center">
                                <button id="start-generation-btn" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg">
                                    <svg class="w-5 h-5 mr-2 inline" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                    </svg>
                                    å¼€å§‹æ”¹å†™
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Search Results -->
            <div id="view-step-2" class="hidden">
                 <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-6 text-center">AIæ™ºèƒ½ä½“å…¨ç½‘æœç´¢è¿‡æ»¤</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3"><input type="checkbox" id="select-all-checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"></th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åºå·</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ¸ é“</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å†…å®¹æ‘˜è¦</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‚¹èµ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è¯„è®º</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æŸ¥çœ‹åŸæ–‡</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-8 text-center">
                        <button id="go-to-rewrite-btn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full transition-transform transform hover:scale-105 shadow-lg" disabled>
                            è¯·å…ˆé€‰æ‹©å†…å®¹
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Rewriting -->
            <div id="view-step-3" class="hidden">
                <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-6 text-center">æ‰¹é‡æ–‡æ¡ˆæ”¹å†™</h2>
                    <div id="rewrite-list-container" class="space-y-6 max-h-[60vh] overflow-y-auto p-2">
                        <!-- JS will populate this -->
                    </div>
                     <div class="mt-8 text-center">
                        <button id="go-to-preview-btn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full transition-transform transform hover:scale-105 shadow-lg">
                            ä¸‹ä¸€æ­¥ï¼šç¡®è®¤è¾“å‡º
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Preview -->
            <div id="view-step-4" class="hidden">
                 <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-6 text-center">ç¡®è®¤è¾“å‡ºåˆ°çŸ¥è¯†åº“</h2>
                    <p class="text-center text-gray-600 mb-6">ä»¥ä¸‹ <span id="final-count" class="font-bold text-blue-600"></span> æ¡å†…å®¹å°†è¢«å­˜å…¥çŸ¥è¯†åº“ã€‚</p>
                    <div id="final-preview-container" class="space-y-4 max-h-[60vh] overflow-y-auto bg-gray-50 p-4 rounded-lg">
                        <!-- JS will populate this -->
                    </div>

                    <div class="mt-8 text-center space-x-4">
                        <button id="restart-btn" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-10 rounded-full transition-transform transform hover:scale-105 shadow-lg">
                            è¿”å›ä¿®æ”¹
                        </button>
                        <button id="confirm-save-btn" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-10 rounded-full transition-transform transform hover:scale-105 shadow-lg">
                            ç¡®è®¤å¹¶å­˜å…¥çŸ¥è¯†åº“
                        </button>
                    </div>
                 </div>
            </div>

            <!-- Loading View -->
            <div id="view-loading" class="hidden">
                 <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 flex flex-col items-center justify-center min-h-[400px]">
                     <div class="loader h-16 w-16 rounded-full border-4 border-gray-200"></div>
                     <p id="loading-text" class="mt-6 text-xl font-medium text-gray-700">æ­£åœ¨æœç´¢å…¨ç½‘å†…å®¹...</p>
                 </div>
            </div>
        </div>

        <!-- Modal for Original Text -->
        <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50">
            <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col transform scale-95 opacity-0">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 class="text-lg font-bold">åŸæ–‡å†…å®¹</h3>
                    <button id="modal-close-btn" class="text-gray-500 hover:text-gray-800">&times;</button>
                </div>
                <div id="modal-body" class="p-6 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Modal for Scheduled Tasks -->
        <div id="tasks-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50">
            <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col transform scale-95 opacity-0">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 class="text-lg font-bold">å†å²å®šæ—¶ä»»åŠ¡</h3>
                    <button id="tasks-modal-close-btn" class="text-gray-500 hover:text-gray-800">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <div id="tasks-container">
                        <div class="text-center text-gray-500 py-8">
                            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                            </svg>
                            <p>æš‚æ— å®šæ—¶ä»»åŠ¡</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for WeChat Users Management -->
        <div id="wechat-users-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50">
            <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] flex flex-col transform scale-95 opacity-0">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 class="text-lg font-bold">ç®¡ç†å¾®ä¿¡ç”¨æˆ·</h3>
                    <button id="wechat-users-modal-close-btn" class="text-gray-500 hover:text-gray-800">&times;</button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <!-- æ·»åŠ ç”¨æˆ·è¡¨å• -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-800 mb-3">æ·»åŠ æ–°ç”¨æˆ·</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <input type="text" id="new-user-name" placeholder="å§“å" class="form-input block w-full text-sm rounded-md border-gray-300 shadow-sm">
                            <input type="text" id="new-user-wechat" placeholder="å¾®ä¿¡å·/æ‰‹æœºå·" class="form-input block w-full text-sm rounded-md border-gray-300 shadow-sm">
                            <button id="add-wechat-user-btn" class="bg-green-100 hover:bg-green-200 text-green-700 font-medium py-2 px-4 rounded-md transition-colors duration-200 text-sm">
                                æ·»åŠ ç”¨æˆ·
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç”¨æˆ·åˆ—è¡¨ -->
                    <div>
                        <h4 class="text-sm font-medium text-gray-800 mb-3">ç”¨æˆ·åˆ—è¡¨</h4>
                        <div id="wechat-users-management-list" class="space-y-2">
                            <div class="text-center text-gray-400 text-sm py-4">
                                æš‚æ— å¾®ä¿¡ç”¨æˆ·ï¼Œè¯·å…ˆæ·»åŠ ç”¨æˆ·
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t bg-gray-50 flex justify-end">
                    <button id="wechat-users-save-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-6 rounded-md transition-colors duration-200">
                        ä¿å­˜è®¾ç½®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const mockData = {
            searchResults: [
                { id: 1, channel: 'æŠ–éŸ³', enterprise: 'ä¼ä¸šåŸºä¸šé•¿é’çš„ä¸€ä¸ª...', score: 16656, comments: 509, shares: 771, collections: 1074, original: 'å…³é”®è®®é¢˜åœ¨äºæ¥ç­äººï¼Œè¿™åº”è¯¥æ˜¯ä¸€æ¬¡ä¸»åŠ¨çš„ä¼ æ‰¿ï¼Œæ›´æ˜¯å¯¹ä¸‹ä¸€ä»£é¢†å¯¼è€…æˆé•¿çš„ä¸€æ¬¡å®Œç¾è¡¨è¾¾ã€‚æˆ‘è®¤ä¸ºï¼Œå®¶åº­å’Œäº‹ä¸šçš„èåˆï¼Œå¯¹äºåŸ¹å…»å…·å¤‡å…¨é¢è§†é‡å’Œæ·±åšæƒ…æ„Ÿçš„æ¥ç­äººè‡³å…³é‡è¦ã€‚æˆ‘ä¸€ç›´è§‰å¾—æˆ‘ä»¬è¿™ä¸€ä»£å’Œä¸Šä¸€ä»£ä¹‹é—´æœ‰å¾ˆå¤šçš„å…±åŒç‚¹ï¼Œæˆ‘ä»¬ä¸€èµ·å¾€å‰èµ°ï¼Œæœªæ¥å¯èƒ½æˆ‘è§‰å¾—æˆ‘ä»¬è¿™ä¸€ä»£äººè¿˜æ˜¯ç›¸å¯¹æ¥è®²æ¯”è¾ƒå¹¸è¿çš„ï¼Œé¦–å…ˆæœ‰ä¸Šä¸€ä»£æˆ–è€…ä¸¤ä»£äººç»™æˆ‘ä»¬æ‰“ä¸‹ä¸€äº›åŸºç¡€ã€‚è¿™ä¸ªç¾¤ä½“çš„æ¯”ä¾‹æ¯”è¾ƒå°ï¼Œå¦ä¸€æ–¹é¢æ˜¯æˆ‘ä»¬é¢å¯¹è¿™ä¸ªç¾¤ä½“çš„æ ·æœ¬...' },
                { id: 2, channel: 'æŠ–éŸ³', enterprise: 'åˆ›äºŒä»£...', score: 61, comments: 106, shares: 707, collections: 753, original: 'â€œåˆ›äºŒä»£â€ä¸ä»…ä»…æ˜¯è´¢å¯Œçš„ç»§æ‰¿è€…ï¼Œæ›´æ˜¯åˆ›æ–°ç²¾ç¥çš„æ¥æ£’è€…ã€‚ä»–ä»¬é¢ä¸´çš„æŒ‘æˆ˜æ˜¯å¦‚ä½•åœ¨çˆ¶è¾ˆçš„å…‰ç¯ä¸‹ï¼Œèµ°å‡ºè‡ªå·±çš„é“è·¯ï¼Œå®ç°ä¼ä¸šçš„äºŒæ¬¡å¢é•¿å’Œè½¬å‹å‡çº§ã€‚' },
                { id: 3, channel: 'æŠ–éŸ³', enterprise: 'ä¼ä¸š...', score: 83, comments: 16, shares: 2, collections: 8, original: 'å¾ˆå¤šä¼ä¸šåœ¨è°ˆè®ºâ€œåŸºä¸šé•¿é’â€æ—¶ï¼Œå¾€å¾€å¿½ç•¥äº†æœ€æ ¸å¿ƒçš„æƒ…æ„Ÿçº½å¸¦ã€‚æ²¡æœ‰æƒ…æ„Ÿçš„ä¼ æ‰¿ï¼Œå†å¥½çš„åˆ¶åº¦è®¾è®¡ä¹Ÿåªæ˜¯ç©ºå£³ã€‚å®¶æ—ä¼ä¸šçš„é­‚ï¼Œåœ¨äºä»·å€¼è§‚çš„ä»£ä»£ç›¸ä¼ ã€‚'},
                { id: 4, channel: 'æŠ–éŸ³', enterprise: 'æ–°æ¶ˆè´¹å“ç‰Œ...', score: 1204, comments: 88, shares: 150, collections: 300, original: 'å½“å‰æ–°æ¶ˆè´¹å“ç‰Œçš„æ ¸å¿ƒé—®é¢˜åœ¨äºå¦‚ä½•å»ºç«‹å“ç‰ŒæŠ¤åŸæ²³ã€‚å•çº¯ä¾èµ–æµé‡æŠ•æ”¾çš„æ¨¡å¼å·²ç»èµ°åˆ°å°½å¤´ï¼Œå¿…é¡»å›å½’äº§å“å’Œç”¨æˆ·ä½“éªŒçš„æœ¬è´¨ï¼Œé€šè¿‡æƒ…æ„Ÿè¿æ¥å»ºç«‹å¿ è¯šåº¦ã€‚'},
            ],
            rewrittenResults: (originalText) => [
                { id: 1, text: `ä¼ä¸šåŸºä¸šé•¿é’çš„ä¸€ä¸ªå…³é”®è®®é¢˜åœ¨äºæ¥ç­äººï¼Œè¿™åº”è¯¥æ˜¯ä¸€æ¬¡**ä¸»åŠ¨æ¥æ£’**ï¼Œæ˜¯ä¸€æ¬¡æ›´å¥½çš„æˆé•¿ï¼Œæ›´æ˜¯è¦æ±‚ä¼ä¸šå®¶äºŒä»£éœ€è¦ç«‹åˆ»ç«‹äººâ€œ**ä¸»åŠ¨ä¼ æ‰¿**â€çš„ç²¾ç¥ï¼Œå»¶ç»­çˆ¶è¾ˆå¯¹åˆ›ä¸šç²¾ç¥çš„åšå®ˆï¼ŒåŒæ—¶ä¹Ÿè¦åšå¥½çˆ¶è¾ˆç§¯ç´¯çš„èµ„é‡‘ã€äººè„‰ä¸å“ç‰Œçš„**ä¼ æ‰¿**ï¼Œå®ç°ç°ä»£çš„æˆä¸ºæ–°ç‰ˆâ€œåˆ›äºŒä»£â€ã€‚`},
                { id: 2, text: `æƒ³è®©ä¼ä¸šåŸºä¸šé•¿é’ï¼Œæ¥ç­äººçš„é€‰æ‹©è‡³å…³é‡è¦ã€‚è¿™ä¸ä»…æ˜¯ä¸€æ¬¡**ä¸»åŠ¨æ¥æ£’**ï¼Œæ›´æ˜¯æ–°ä¸€ä»£é¢†å¯¼è€…æˆé•¿çš„ä½“ç°ã€‚è¦å®ç°å®Œç¾çš„**ä¼ æ‰¿**ï¼Œå°±éœ€è¦å°†å®¶åº­ä¸äº‹ä¸šèåˆï¼ŒåŸ¹å…»å‡ºæœ‰å…¨é¢è§†é‡å’Œæ·±åšæƒ…æ„Ÿçš„â€œåˆ›äºŒä»£â€ã€‚` },
                { id: 3, text: `â€œåˆ›äºŒä»£â€çš„**ä¸»åŠ¨ä¼ æ‰¿**æ˜¯ä¼ä¸šæŒç»­å‘å±•çš„å…³é”®ã€‚ä»–ä»¬éœ€è¦**ä¸»åŠ¨æ¥æ£’**ï¼Œåœ¨çˆ¶è¾ˆæ‰“ä¸‹çš„åŸºç¡€ä¸Šï¼Œå®ç°è‡ªæˆ‘ä»·å€¼å’Œä¼ä¸šçš„å†æ¬¡é£è·ƒã€‚è¿™ä¸ä»…æ˜¯è´¢å¯Œçš„**ä¼ æ‰¿**ï¼Œæ›´æ˜¯ç²¾ç¥ä¸è´£ä»»çš„å»¶ç»­ã€‚` }
            ]
        };

        let selectedIds = new Set();
        let finalSelections = {}; // { originalId: rewrittenText }
        let currentExecutionMode = 'step-by-step'; // 'one-click' or 'step-by-step'

        const views = { step1: document.getElementById('view-step-1'), step2: document.getElementById('view-step-2'), step3: document.getElementById('view-step-3'), step4: document.getElementById('view-step-4'), loading: document.getElementById('view-loading'), };

        const goToStep = (stepNumber) => {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            if (views[`step${stepNumber}`]) views[`step${stepNumber}`].classList.remove('hidden');
            
            // æ›´æ–°æ”¹å†™åŠŸèƒ½ä¸“ç”¨çš„æ­¥éª¤æŒ‡ç¤ºå™¨
            for (let i = 1; i <= 4; i++) {
                const indicator = document.getElementById(`rewrite-step-${i}-indicator`);
                if (indicator) {
                    const circle = indicator.querySelector('div');
                    const text = indicator.querySelector('span');
                    
                    if (i < stepNumber) {
                        // å·²å®Œæˆçš„æ­¥éª¤
                        circle.className = 'w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold';
                        text.className = 'ml-2 text-sm text-green-600 font-medium';
                    } else if (i === stepNumber) {
                        // å½“å‰æ´»è·ƒæ­¥éª¤
                        circle.className = 'w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold';
                        text.className = 'ml-2 text-sm text-green-600 font-medium';
                    } else {
                        // æœªå®Œæˆçš„æ­¥éª¤
                        circle.className = 'w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs font-bold';
                        text.className = 'ml-2 text-sm text-gray-500';
                    }
                }
            }
        };

        const showLoading = (text, duration, callback) => {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            document.getElementById('loading-text').textContent = text;
            views.loading.classList.remove('hidden');
            setTimeout(() => { views.loading.classList.add('hidden'); callback(); }, duration);
        };
        
        // åŸå§‹äº‹ä»¶ç›‘å¬å™¨å·²è¢«ä¸‹æ–¹çš„æ–°é€»è¾‘æ›¿ä»£

        // Step 2 Logic
        const resultsTableBody = document.getElementById('results-table-body');
        const goToRewriteBtn = document.getElementById('go-to-rewrite-btn');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');

        function updateRewriteButtonState() {
            if (selectedIds.size > 0) {
                goToRewriteBtn.disabled = false;
                goToRewriteBtn.textContent = `æ‰¹é‡æ”¹å†™ (${selectedIds.size} é¡¹)`;
            } else {
                goToRewriteBtn.disabled = true;
                goToRewriteBtn.textContent = 'è¯·å…ˆé€‰æ‹©å†…å®¹';
            }
        }

        function populateResultsTable() {
            resultsTableBody.innerHTML = '';
            selectedIds.clear();
            updateRewriteButtonState();
            selectAllCheckbox.checked = false;
            mockData.searchResults.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'table-row-hover';
                row.dataset.resultId = item.id;
                const channelColor = {
                    'æŠ–éŸ³': 'bg-red-100 text-red-800',
                    'å°çº¢ä¹¦': 'bg-pink-100 text-pink-800',
                    'å¾®ä¿¡å…¬ä¼—å·': 'bg-green-100 text-green-800',
                    'Bç«™': 'bg-blue-100 text-blue-800',
                    'å¿«æ‰‹': 'bg-yellow-100 text-yellow-800',
                    'çŸ¥ä¹': 'bg-purple-100 text-purple-800'
                };
                const channelClass = channelColor[item.channel] || 'bg-gray-100 text-gray-800';
                
                row.innerHTML = `
                    <td class="px-6 py-4"><input type="checkbox" data-id="${item.id}" class="row-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 text-xs font-medium rounded-full ${channelClass}">${item.channel || 'æœªçŸ¥'}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.enterprise}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-bold">${item.score.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.comments.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center"><button class="view-original-btn text-blue-600 hover:text-blue-800" data-id="${item.id}">æŸ¥çœ‹</button></td>
                `;
                resultsTableBody.appendChild(row);
            });
        }
        
        resultsTableBody.addEventListener('click', (e) => {
            const row = e.target.closest('tr');
            if (!row) return;

            if (e.target.classList.contains('view-original-btn')) {
                 const id = parseInt(e.target.dataset.id);
                 const item = mockData.searchResults.find(i => i.id === id);
                 document.getElementById('modal-body').textContent = item.original;
                 showModal();
                 return;
            }

            const checkbox = row.querySelector('.row-checkbox');
            if (e.target !== checkbox) {
                checkbox.checked = !checkbox.checked;
            }
            
            const id = parseInt(checkbox.dataset.id);
            if(checkbox.checked) {
                selectedIds.add(id);
                row.classList.add('table-row-selected');
            } else {
                selectedIds.delete(id);
                row.classList.remove('table-row-selected');
            }
            
            selectAllCheckbox.checked = selectedIds.size === mockData.searchResults.length;
            updateRewriteButtonState();
        });
        
        selectAllCheckbox.addEventListener('click', () => {
            const isChecked = selectAllCheckbox.checked;
            const rowCheckboxes = document.querySelectorAll('.row-checkbox');
            
            rowCheckboxes.forEach(checkbox => {
                const id = parseInt(checkbox.dataset.id);
                const row = checkbox.closest('tr');
                checkbox.checked = isChecked;
                if (isChecked) {
                    selectedIds.add(id);
                    row.classList.add('table-row-selected');
                } else {
                    selectedIds.delete(id);
                    row.classList.remove('table-row-selected');
                }
            });
            updateRewriteButtonState();
        });

        goToRewriteBtn.addEventListener('click', () => {
            if (selectedIds.size > 0) {
                showLoading('æ­£åœ¨ç”Ÿæˆæ”¹å†™æ–‡æ¡ˆ...', 1500, () => {
                    populateRewriteView();
                    goToStep(3);
                });
            }
        });

        // Step 3 Logic
        function populateRewriteView() {
            const container = document.getElementById('rewrite-list-container');
            container.innerHTML = '';
            finalSelections = {};

            const selectedItems = mockData.searchResults.filter(item => selectedIds.has(item.id));
            selectedItems.forEach(originalItem => {
                const card = document.createElement('div');
                card.className = 'p-4 border rounded-lg bg-white shadow-sm';
                
                const rewrittenTexts = mockData.rewrittenResults(originalItem.original);
                finalSelections[originalItem.id] = rewrittenTexts[0].text; // Default selection

                let rewritesHtml = rewrittenTexts.map((rewrite, index) => `
                    <div class="p-3 border-t mt-3">
                        <label class="flex items-start cursor-pointer">
                            <input type="radio" name="rewrite_for_${originalItem.id}" value="${escape(rewrite.text)}" class="mt-1 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" ${index === 0 ? 'checked' : ''}>
                            <span class="ml-3 text-sm text-gray-700">${rewrite.text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-blue-600">$1</strong>')}</span>
                        </label>
                    </div>
                `).join('');

                card.innerHTML = `
                    <p class="font-semibold text-gray-800">åŸæ–‡ ${originalItem.id}:</p>
                    <p class="text-sm text-gray-500 mt-1 mb-2 bg-gray-50 p-2 rounded">${originalItem.original}</p>
                    <p class="font-semibold text-gray-800">æ”¹å†™ç‰ˆæœ¬ (è¯·é€‰æ‹©ä¸€é¡¹):</p>
                    ${rewritesHtml}
                `;
                container.appendChild(card);
            });
            
            container.addEventListener('change', e => {
                if (e.target.type === 'radio') {
                    const originalId = parseInt(e.target.name.replace('rewrite_for_', ''));
                    finalSelections[originalId] = unescape(e.target.value);
                }
            });
        }
        
        document.getElementById('go-to-preview-btn').addEventListener('click', () => {
             showLoading('æ­£åœ¨å‡†å¤‡é¢„è§ˆ...', 1000, () => {
                populateFinalPreview();
                goToStep(4);
            });
        });

        // Step 4 Logic
        function populateFinalPreview() {
            const container = document.getElementById('final-preview-container');
            container.innerHTML = '';
            const finalCount = Object.keys(finalSelections).length;
            document.getElementById('final-count').textContent = finalCount;

            for (const originalId in finalSelections) {
                const originalItem = mockData.searchResults.find(i => i.id == originalId);
                const card = document.createElement('div');
                card.className = 'p-4 bg-white rounded shadow-sm';
                card.innerHTML = `
                    <p class="text-xs text-gray-500">æºè‡ªåŸæ–‡ #${originalId}: ${originalItem.enterprise}</p>
                    <p class="mt-2 text-gray-800">${finalSelections[originalId].replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>
                `;
                container.appendChild(card);
            }
        }
        
        document.getElementById('confirm-save-btn').addEventListener('click', () => {
            const btn = document.getElementById('confirm-save-btn');
            btn.textContent = 'ä¿å­˜ä¸­...';
            btn.disabled = true;
            setTimeout(() => {
                alert(`${Object.keys(finalSelections).length} æ¡å†…å®¹å·²æˆåŠŸå­˜å…¥çŸ¥è¯†åº“!`);
                btn.textContent = 'ç¡®è®¤å¹¶å­˜å…¥çŸ¥è¯†åº“';
                btn.disabled = false;
                resetApp();
            }, 1500);
        });

        document.getElementById('restart-btn').addEventListener('click', () => {
            if (currentExecutionMode === 'one-click') {
                // ä¸€é”®ç”Ÿæˆæ¨¡å¼ï¼šå›åˆ°é¦–é¡µ
                goToStep(1);
            } else {
                // åˆ†æ­¥æ‰§è¡Œæ¨¡å¼ï¼šå›åˆ°æ”¹å†™é€‰æ‹©é¡µé¢
                goToStep(3);
            }
        });
        
        function resetApp() {
            selectedIds.clear();
            finalSelections = {};
            currentExecutionMode = 'step-by-step';
            updateRewriteButtonState();
            goToStep(1);
        }

        // Modal Logic
        const modal = document.getElementById('modal');
        const modalContent = modal.querySelector('.modal-content');
        const showModal = () => { modal.classList.remove('hidden'); setTimeout(() => { modal.classList.remove('bg-opacity-0'); modalContent.classList.remove('scale-95', 'opacity-0'); }, 10); };
        const hideModal = () => { modal.classList.add('bg-opacity-0'); modalContent.classList.add('scale-95', 'opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); };
        document.getElementById('modal-close-btn').addEventListener('click', hideModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) hideModal(); });

        // Tasks Modal Logic
        const tasksModal = document.getElementById('tasks-modal');
        const tasksModalContent = tasksModal.querySelector('.modal-content');
        const showTasksModal = () => { tasksModal.classList.remove('hidden'); setTimeout(() => { tasksModal.classList.remove('bg-opacity-0'); tasksModalContent.classList.remove('scale-95', 'opacity-0'); }, 10); };
        const hideTasksModal = () => { tasksModal.classList.add('bg-opacity-0'); tasksModalContent.classList.add('scale-95', 'opacity-0'); setTimeout(() => tasksModal.classList.add('hidden'), 300); };
        document.getElementById('tasks-modal-close-btn').addEventListener('click', hideTasksModal);
        tasksModal.addEventListener('click', (e) => { if (e.target === tasksModal) hideTasksModal(); });

        // WeChat Users Modal Logic
        const wechatUsersModal = document.getElementById('wechat-users-modal');
        const wechatUsersModalContent = wechatUsersModal.querySelector('.modal-content');
        const showWechatUsersModal = () => { wechatUsersModal.classList.remove('hidden'); setTimeout(() => { wechatUsersModal.classList.remove('bg-opacity-0'); wechatUsersModalContent.classList.remove('scale-95', 'opacity-0'); }, 10); };
        const hideWechatUsersModal = () => { wechatUsersModal.classList.add('bg-opacity-0'); wechatUsersModalContent.classList.add('scale-95', 'opacity-0'); setTimeout(() => wechatUsersModal.classList.add('hidden'), 300); };
        document.getElementById('wechat-users-modal-close-btn').addEventListener('click', hideWechatUsersModal);
        wechatUsersModal.addEventListener('click', (e) => { if (e.target === wechatUsersModal) hideWechatUsersModal(); });

        // æ¨¡æ‹Ÿå†å²ä»»åŠ¡æ•°æ®
        let scheduledTasks = [
            {
                id: 1,
                type: 'å®šæ—¶æŠ¥å‘Š',
                frequency: 'æ¯å¤©',
                time: '09:00',
                status: 'è¿è¡Œä¸­',
                createdAt: '2024-01-15 14:30',
                nextRun: '2024-01-16 09:00'
            },
            {
                id: 2,
                type: 'å®šæ—¶æŠ¥å‘Š',
                frequency: 'æ¯å‘¨',
                time: '15:00',
                weekday: 'æ¯å‘¨ä¸€',
                status: 'æš‚åœ',
                createdAt: '2024-01-10 16:20',
                nextRun: '2024-01-22 15:00'
            }
        ];

        // å¾®ä¿¡ç”¨æˆ·æ•°æ®
        let wechatUsers = [
            {
                id: 1,
                name: 'å¼ ç»ç†',
                wechat: 'zhang_manager',
                selected: true
            },
            {
                id: 2,
                name: 'ææ€»ç›‘',
                wechat: '13812345678',
                selected: false
            }
        ];

        function renderScheduledTasks() {
            const container = document.getElementById('tasks-container');
            
            if (scheduledTasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                        <p>æš‚æ— å®šæ—¶ä»»åŠ¡</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="space-y-4">
                    ${scheduledTasks.map(task => `
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full ${task.status === 'è¿è¡Œä¸­' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${task.status}</span>
                                        <span class="text-sm font-medium text-gray-900">${task.type}</span>
                                    </div>
                                    <div class="text-sm text-gray-600 space-y-1">
                                        <p><span class="font-medium">é¢‘ç‡:</span> ${task.frequency}${task.weekday ? ' (' + task.weekday + ')' : ''}</p>
                                        <p><span class="font-medium">æ—¶é—´:</span> ${task.time}</p>
                                        <p><span class="font-medium">å¾®ä¿¡æ¨é€:</span> ${task.wechatUsers || 'æ— '}</p>
                                        <p><span class="font-medium">åˆ›å»ºæ—¶é—´:</span> ${task.createdAt}</p>
                                        <p><span class="font-medium">ä¸‹æ¬¡æ‰§è¡Œ:</span> ${task.nextRun}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="toggleTask(${task.id})" class="px-3 py-1 text-xs font-medium rounded ${task.status === 'è¿è¡Œä¸­' ? 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200' : 'bg-green-100 text-green-800 hover:bg-green-200'} transition-colors">
                                        ${task.status === 'è¿è¡Œä¸­' ? 'æš‚åœ' : 'å¯åŠ¨'}
                                    </button>
                                    <button onclick="cancelTask(${task.id})" class="px-3 py-1 text-xs font-medium rounded bg-red-100 text-red-800 hover:bg-red-200 transition-colors">
                                        å–æ¶ˆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        window.toggleTask = function(taskId) {
            const task = scheduledTasks.find(t => t.id === taskId);
            if (task) {
                task.status = task.status === 'è¿è¡Œä¸­' ? 'æš‚åœ' : 'è¿è¡Œä¸­';
                renderScheduledTasks();
            }
        };

        window.cancelTask = function(taskId) {
            if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªå®šæ—¶ä»»åŠ¡å—ï¼Ÿ')) {
                scheduledTasks = scheduledTasks.filter(t => t.id !== taskId);
                renderScheduledTasks();
            }
        };

        // å¾®ä¿¡ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        function renderWechatUsersList() {
            const container = document.getElementById('wechat-users-list');
            
            if (wechatUsers.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 text-xs py-2">
                        è¯·å…ˆæ·»åŠ å¾®ä¿¡ç”¨æˆ·
                    </div>
                `;
                updateSelectedUsersCount();
                return;
            }

            container.innerHTML = wechatUsers.map(user => `
                <label class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer">
                    <input type="checkbox" ${user.selected ? 'checked' : ''} 
                           onchange="toggleWechatUser(${user.id})" 
                           class="h-3 w-3 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                    <div class="ml-2 flex-1 min-w-0">
                        <p class="text-xs font-medium text-gray-900 truncate">${user.name}</p>
                        <p class="text-xs text-gray-500 truncate">${user.wechat}</p>
                    </div>
                </label>
            `).join('');
            
            updateSelectedUsersCount();
        }

        function renderWechatUsersManagementList() {
            const container = document.getElementById('wechat-users-management-list');
            
            if (wechatUsers.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 text-sm py-4">
                        æš‚æ— å¾®ä¿¡ç”¨æˆ·ï¼Œè¯·å…ˆæ·»åŠ ç”¨æˆ·
                    </div>
                `;
                return;
            }

            container.innerHTML = wechatUsers.map(user => `
                <div class="flex items-center justify-between p-3 bg-white rounded border">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">${user.name}</p>
                        <p class="text-xs text-gray-500">${user.wechat}</p>
                    </div>
                    <button onclick="removeWechatUser(${user.id})" 
                            class="ml-3 px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-800 hover:bg-red-200 transition-colors">
                        åˆ é™¤
                    </button>
                </div>
            `).join('');
        }

        function updateSelectedUsersCount() {
            const count = wechatUsers.filter(user => user.selected).length;
            document.getElementById('selected-users-count').textContent = count;
        }

        window.toggleWechatUser = function(userId) {
            const user = wechatUsers.find(u => u.id === userId);
            if (user) {
                user.selected = !user.selected;
                updateSelectedUsersCount();
            }
        };

        window.removeWechatUser = function(userId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ')) {
                wechatUsers = wechatUsers.filter(u => u.id !== userId);
                renderWechatUsersManagementList();
                renderWechatUsersList();
            }
        };

        function addWechatUser() {
            const nameInput = document.getElementById('new-user-name');
            const wechatInput = document.getElementById('new-user-wechat');
            
            const name = nameInput.value.trim();
            const wechat = wechatInput.value.trim();
            
            if (!name || !wechat) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (wechatUsers.some(u => u.wechat === wechat)) {
                alert('è¯¥å¾®ä¿¡å·å·²å­˜åœ¨');
                return;
            }

            const newUser = {
                id: Date.now(),
                name: name,
                wechat: wechat,
                selected: false
            };

            wechatUsers.push(newUser);
            renderWechatUsersManagementList();
            renderWechatUsersList();

            // æ¸…ç©ºè¾“å…¥æ¡†
            nameInput.value = '';
            wechatInput.value = '';
        }

        // æ–°å¢åŠŸèƒ½çš„äº‹ä»¶ç›‘å¬å™¨
        
        // å¾®ä¿¡æ¨é€è®¾ç½®å·²é›†æˆåˆ°å®šæ—¶è®¾ç½®ä¸­

        document.getElementById('manage-wechat-users-btn').addEventListener('click', () => {
            renderWechatUsersManagementList();
            showWechatUsersModal();
        });

        document.getElementById('add-wechat-user-btn').addEventListener('click', addWechatUser);

        document.getElementById('wechat-users-save-btn').addEventListener('click', () => {
            renderWechatUsersList();
            hideWechatUsersModal();
        });

        // æ”¯æŒå›è½¦é”®æ·»åŠ ç”¨æˆ·
        document.getElementById('new-user-name').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addWechatUser();
            }
        });

        document.getElementById('new-user-wechat').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addWechatUser();
            }
        });
        
        // æŠ¥å‘Šè®¾ç½®åŠŸèƒ½æŒ‰é’®
        document.getElementById('view-scheduled-tasks-btn').addEventListener('click', () => {
            renderScheduledTasks();
            showTasksModal();
        });

        document.getElementById('start-monitoring-btn').addEventListener('click', () => {
            const instantReport = document.getElementById('instant-report').checked;
            const scheduledReport = document.getElementById('scheduled-report').checked;
            
            if (!instantReport && !scheduledReport) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§æŠ¥å‘Šç”Ÿæˆæ–¹å¼');
                return;
            }
            
            let settingsText = 'è®¾ç½®å·²ç”Ÿæ•ˆï¼š\n';
            
            if (instantReport) {
                settingsText += 'â€¢ å³æ—¶ç”ŸæˆæŠ¥å‘Šå·²å¯ç”¨\n';
            }
            
            if (scheduledReport) {
                const frequency = document.getElementById('schedule-frequency').value;
                const hour = document.getElementById('schedule-hour').value;
                const weekday = document.getElementById('schedule-weekday').value;
                
                // æ£€æŸ¥å¾®ä¿¡æ¨é€ç”¨æˆ·
                const selectedUsers = wechatUsers.filter(user => user.selected);
                if (selectedUsers.length === 0) {
                    const shouldContinue = confirm('æ‚¨è¿˜æ²¡æœ‰é€‰æ‹©å¾®ä¿¡æ¨é€å¯¹è±¡ã€‚\næ˜¯å¦ç»§ç»­ç”Ÿæ•ˆè®¾ç½®ï¼Ÿï¼ˆåªä¼šç”ŸæˆæŠ¥å‘Šï¼Œä¸ä¼šæ¨é€ï¼‰');
                    if (!shouldContinue) {
                        return;
                    }
                }
                
                settingsText += 'â€¢ å®šæ—¶ç”ŸæˆæŠ¥å‘Šå·²å¯ç”¨\n';
                settingsText += `  - é¢‘ç‡: ${frequency === 'daily' ? 'æ¯å¤©' : 'æ¯å‘¨'}\n`;
                settingsText += `  - æ—¶é—´: ${hour}:00\n`;
                
                if (frequency === 'weekly') {
                    const weekdayNames = ['æ¯å‘¨æ—¥', 'æ¯å‘¨ä¸€', 'æ¯å‘¨äºŒ', 'æ¯å‘¨ä¸‰', 'æ¯å‘¨å››', 'æ¯å‘¨äº”', 'æ¯å‘¨å…­'];
                    settingsText += `  - æ—¥æœŸ: ${weekdayNames[weekday]}\n`;
                }
                
                if (selectedUsers.length > 0) {
                    settingsText += `  - å¾®ä¿¡æ¨é€: ${selectedUsers.map(u => u.name).join('ã€')}\n`;
                }
                
                // æ¨¡æ‹Ÿæ·»åŠ æ–°ä»»åŠ¡åˆ°å†å²ä»»åŠ¡åˆ—è¡¨
                const newTask = {
                    id: Date.now(),
                    type: 'å®šæ—¶æŠ¥å‘Š',
                    frequency: frequency === 'daily' ? 'æ¯å¤©' : 'æ¯å‘¨',
                    time: hour + ':00',
                    weekday: frequency === 'weekly' ? ['æ¯å‘¨æ—¥', 'æ¯å‘¨ä¸€', 'æ¯å‘¨äºŒ', 'æ¯å‘¨ä¸‰', 'æ¯å‘¨å››', 'æ¯å‘¨äº”', 'æ¯å‘¨å…­'][weekday] : null,
                    status: 'è¿è¡Œä¸­',
                    createdAt: new Date().toLocaleString('zh-CN'),
                    nextRun: getNextRunTime(frequency, hour, weekday),
                    wechatUsers: selectedUsers.length > 0 ? selectedUsers.map(u => u.name).join('ã€') : 'æ— '
                };
                
                scheduledTasks.push(newTask);
            }
            
            alert(settingsText);
        });

        function getNextRunTime(frequency, hour, weekday) {
            const now = new Date();
            const nextRun = new Date();
            
            if (frequency === 'daily') {
                nextRun.setHours(parseInt(hour), 0, 0, 0);
                if (nextRun <= now) {
                    nextRun.setDate(nextRun.getDate() + 1);
                }
            } else {
                const targetWeekday = parseInt(weekday);
                const currentWeekday = now.getDay();
                let daysUntilTarget = (targetWeekday - currentWeekday + 7) % 7;
                
                if (daysUntilTarget === 0 && now.getHours() >= parseInt(hour)) {
                    daysUntilTarget = 7;
                }
                
                nextRun.setDate(now.getDate() + daysUntilTarget);
                nextRun.setHours(parseInt(hour), 0, 0, 0);
            }
            
            return nextRun.toLocaleString('zh-CN');
        }
        
        // å®šæ—¶æŠ¥å‘Šåˆ‡æ¢
        document.getElementById('scheduled-report').addEventListener('change', function() {
            const scheduleContainer = document.getElementById('schedule-time-container');
            if (this.checked) {
                scheduleContainer.classList.remove('hidden');
            } else {
                scheduleContainer.classList.add('hidden');
            }
        });

        // å®šæ—¶é¢‘ç‡é€‰æ‹©åˆ‡æ¢
        document.getElementById('schedule-frequency').addEventListener('change', function() {
            const weeklyContainer = document.getElementById('weekly-day-container');
            if (this.value === 'weekly') {
                weeklyContainer.classList.remove('hidden');
            } else {
                weeklyContainer.classList.add('hidden');
            }
        });

        // åŠŸèƒ½é€‰æ‹©å˜åŒ–å¤„ç†
        document.querySelectorAll('input[name="execution-mode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const isOneClick = this.value === 'one-click';
                document.getElementById('start-generation-btn').textContent = 
                    isOneClick ? 'ä¸€é”®ç”Ÿæˆ' : 'å¼€å§‹ç”Ÿæˆ';
            });
        });



        // å¼€å§‹ç”ŸæˆæŒ‰é’®çš„å¤„ç†é€»è¾‘
        document.getElementById('start-generation-btn').addEventListener('click', () => {
            const executionMode = document.querySelector('input[name="execution-mode"]:checked').value;
            const selectedChannels = Array.from(document.querySelectorAll('input[name="rewrite-channel"]:checked')).map(cb => cb.value);
            
            if (selectedChannels.length === 0) {
                alert('è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ¸ é“');
                return;
            }
            
            // è®°å½•å½“å‰æ‰§è¡Œæ¨¡å¼
            currentExecutionMode = executionMode;
            
            const channelText = selectedChannels.length === 1 ? 
                getChannelName(selectedChannels[0]) : 
                `${selectedChannels.length}ä¸ªæ¸ é“`;
            
            if (executionMode === 'one-click') {
                // ä¸€é”®ç”Ÿæˆæ¨¡å¼
                showLoading('æ­£åœ¨ä¸€é”®ç”Ÿæˆæ”¹å†™æ–‡æ¡ˆï¼Œè¯·ç¨å€™...', 4000, () => {
                    // æ¨¡æ‹Ÿè‡ªåŠ¨é€‰æ‹©å†…å®¹
                    selectedIds.clear();
                    mockData.searchResults.forEach(item => selectedIds.add(item.id));
                    
                    // ç›´æ¥è·³åˆ°æœ€ç»ˆé¢„è§ˆ
                    populateOneClickResults();
                    goToStep(4);
                });
            } else {
                // åˆ†æ­¥æ‰§è¡Œæ¨¡å¼
                showLoading(`æ­£åœ¨æœç´¢${channelText}å†…å®¹ï¼Œè¯·ç¨å€™...`, 2000, () => {
                    populateResultsTable();
                    goToStep(2);
                });
            }
        });

        function getChannelName(value) {
            const channelNames = {
                'douyin': 'æŠ–éŸ³',
                'xiaohongshu': 'å°çº¢ä¹¦',
                'bilibili': 'Bç«™',
                'kuaishou': 'å¿«æ‰‹',
                'zhihu': 'çŸ¥ä¹'
            };
            return channelNames[value] || value;
        }

        function populateOneClickResults() {
            finalSelections = {};
            mockData.searchResults.forEach(originalItem => {
                const rewrittenTexts = mockData.rewrittenResults(originalItem.original);
                finalSelections[originalItem.id] = rewrittenTexts[0].text; // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª
            });
            populateFinalPreview();
        }

        // Initial state
        goToStep(1);
        
        // åˆå§‹åŒ–å¾®ä¿¡ç”¨æˆ·åˆ—è¡¨
        renderWechatUsersList();
    });
    </script>
</body>
</html>
